# Chapter 1:基本知識

本書を手にされているという事は、当然ながら、C++プログラミングを学習しようとしているという事でしょう。今すぐにでもコーディングを始めたいところかもしれませんが、その前に、基本知識を何点か解説しておきます。

* 1.0 プログラミングからコンピューターでアプリケーションが実行、終了されるまでの流れ

* 1.1 C++17とは

* 1.2 開発環境を整える

第1章では以上の基本的な概念を解説します。<br>いざ、C++プログラミングの旅へ出かけましょう。

## 1.0 プログラミングからコンピューターでアプリケーションが実行、終了されるまでの流れ

何の言語でプログラミングを習得するのかは無関係に、プログラムを組んで実行、終了するまでの流れを理解する事は、とても重要です。<br>その流れを理解するためにはまずコンピュータの仕組みを理解する必要があります。

### 1.0.1 コンピュータの仕組み

コンピュータの機能とは、まずどんなものでしょうか。<br>一般的には、主に以下のような機能があると考えられます。

1. 演算/制御機能

2. 記憶機能

3. 入力/出力機能

それぞれの機能を実現するためにはそれぞれの装置(ハードウェア)がなければなりません。まず、1の演算/制御機能を実現する装置とは、何に当てはまるでしょうか。<br>それは主に、CPUと言われています。CPUは、これから述べる記憶機能、入力/出力機能をどのように使うかを司る、謂わばコンピューターの脳です。殆どのCPUは記憶装置からプログラムから読み込み、レジスタと言われるCPU内の装置へ置かれ、順次処理を実行していきます。<br>では、2の記憶機能を実現する装置とはなんでしょうか。それは、主にハードディスクや、SSD、USBといったストレージの他に、RAMといった一時的にデータを記憶する事が可能な装置の事を言います。<br>最後に3の入力/出力の装置とは何でしょうか。入力装置は、キーボードやマウス、マイク、ペンタブなどといったものです。タッチパネルであればそれらも含まれるでしょう。出力装置とは、モニターやスピーカーなどといったものになります。

### 1.0.2 プログラミングからアプリケーションの実行/終了の流れ

大まかな流れとしては以下のようになります。

<pre>1. プログラミング

2. コンパイル

3. 実行形式ファイル生成

4. 実行形式ファイルの起動

5. 記憶装置からメモリへ処理内容を読み込み

6. メモリからCPUのレジスタへ読み込み

7. 本処理

8. メモリに読み込まれている処理内容をメモリから解放

9. 終了</pre>

それぞれの詳細について見ていきます。<br>

#### 1. プログラミング

まずプログラミングをします。これは、これからC++という言語を使って、学んでいく内容です。プログラミング言語は、しばしばコンパイル言語とインタプリタ言語に分類される事があります。コンパイル言語とは、コンパイラーというソフトを使って、機械語に翻訳されたファイルを生成した後に、その内容を実行するという形態の言語を言います。インタプリンタ言語とは、その内容を機械語に翻訳しながら実行するという形態の言語を言います。一般的にはコンパイル言語は、一度機械語に翻訳してしまった後は、ただ実行するだけなので、機械語に翻訳しながら実行するインタプリンタ言語よりも、高速に処理が実行できると言われています。

#### 2. コンパイル

プログラミングが完了したら、次にそのコードに対してコンパイルという作業を行います。コンパイルとは機械語へ翻訳する作業の事を言い、コンパイルを行うアプリケーションをコンパイラと言います。

##### 機械語

機械語とは、CPUが理解できる言葉です。CPUに対して、例えば<i>「1+1の答えは？」</i>と日本語(自然言語)を問いかけても、CPUは理解する事ができません。<br>そもそも、<i>「1+1の答えは？」</i>と人間がコンピュータに対して処理を任せたい場合、大まかに言っても、様々処理がこの中には含まれるはずです。例えば、1+1の答えをどのように人間は知り得る事ができるでしょうか。<br>もしかすると、<i>「1+1の答えは？」</i>と問いただした時点で、あなたは画面に1+1の演算結果が表示されると無意識に考えているかもしれませんが、コンピューターの出力装置として、ディスプレイとスピーカーが用意されている場合、「2」と画面に表示させるのか、「に」と音として出力させるのか、定めなければなりません。<br>仮に、画面に「2」と表示させる事とした場合、表示させるための処理を、これまた定めなければなりません。もはやここまで来ると、全てを定めなければ動いてくれないような気がし始めるかもしれませんが、まさにその通りで、コンピューター、演算装置というものは、人間の「こういった感じにして」というような、感覚的に察してその通りに動いてくれるというような事はありません。<br>話が飛んでしまいましたが、つまり<i>「1+1の答えは？」</i>という人間の問いかけは、機械語的にとても大まかに自然言語化すると、このようになります。

<pre><i>「1+1という式の演算結果を標準出力に最適化して出力してくれ」</i></pre>

では、この内容を機械語で記述しましょう...とは、普通、必要でない限りは一般的にはなりません。何故でしょうか。

##### アセンブリ言語

機械語というものは、0と1のみ(2進数)で命令を表す言語であるのです。それを全て人間が記述して認識するという事は、とても効率的とは言えません。例えば、下記内容は、ある機械語になります。<pre>101110001111111100000000</pre>

この一文は、Intel社が仕様を変更しない限り、86系であれば「CPUのレジスタのオフセットアドレスFFに対して代入処理をしろ」という命令になります。突然よくわからない話になってしまったかもしれませんが、この内容を理解する必要は現時点では全くありません。しかし、我々人間からすれば、この数列が直感的だとは言い難いものです。<br>そこで、機械語命令を人間の話す自然言語に近い単語で表す方法として、アセンブリ言語が考えられました。アセンブリ言語は機械語に対して1対1で命令が対応しています。分かりやすくするため、上記にある2進数の数列を16進数に置き換えてみましょう。

<pre>b8ff00</pre>

これをアセンブリ言語で表すと

<pre>MOV AX,FF</pre>

となります。<br>このアセンブリコードを、機械語へ翻訳するアプリケーションを用いて、機械語のファイルを生成する事で、アプリケーションとして実行する事ができます。この機械語へ翻訳するアプリケーションをアセンブラと言います。 <br>しかしアセンブリ言語も、前述したように機械語を単に自然言語に置き換えただけに過ぎないため、CPUやメモリ、それぞれ用いられるコンピュータ独自の仕様や規格について、プログラマが熟知している必要があります。<br>こういった、機械語に直接的に紐づけられている言語を、低級言語と呼びます。

##### 高級言語

機械語とアセンブリ言語について触れましたが、前述したように、とてもこれはまだ人間向けのコミュニケーション手段としては苦しいところがあります。<br>人間からすれば、1+1についての結果をコンピューターに任せたいとして、<i>「1+1の演算結果を画面に出力しろ」</i>とだけ記述したいものです。決して我々のしたい事はメモリやレジスタへのアクセスなのではなく、1+1の演算結果を得たいのですから、そういった処理はもっと視覚的に直感的な仕組みでラッピング(ある程度隠す)してしまうべきです。そういった形で、より人間に解りやすくした言語の事を、高級言語と言います。高級言語とは、これからあなたが学ぶC++もそうです。もし<i>「1+1の演算結果を画面に出力しろ」</i>を機械語で表したなら、処理系にもよりますが本書の数ページを0と1だけで埋め尽くすでしょう。しかし、C++であれば

```cpp

std::cout << 1 + 1;

```

とだけ記述すれば良いのです。これなら、機械語に比べてより直感的に捉える事ができますし、メモリやレジスタへのアクセスなどといった、本来の問題を解決するための下準備のような処理は全てラッピングされているので、プログラマは本来の問題解決のためだけに注力する事が出来ます。<br>今はまだ

```cpp

std::cout << 1 + 1;

```

も直感的に思えないかもしれませんが、本書を読み進めば思えるようになるでしょう。

##### コンパイラによる最適化

C++の場合、コンパイルすると、まずアセンブリ言語へ翻訳されます。その後、アセンブリ言語をアセンブラにかけて、アセンブリ言語を機械語へと翻訳します。このような流れにする事で、人間が理解しやすいようラッピングされた言葉を用いながらも、高速な実行形式ファイルの生成ができます。<br>コンパイラがアセンブリ言語へ翻訳する段階で、まずコンパイラはプログラマの書いたコードを最適化します。最適化とは、後々理解できるであろう内容となりますが、大まかに言えば、コンパイラがプログラマの書いた無駄な処理/コードを削減するような事を最適化と言います。最適化する事で、より効率的なアセンブリ言語に翻訳されるので、その次段階である機械語翻訳の際に役立ちます。<br>

#### 3. 実行形式ファイル生成

アセンブリ言語が生成されたら、アセンブルによって、いよいよ実行形式である機械語へと翻訳されます。機械語への翻訳過程内で、アセンブラは、さらに最適化を行います。ここでの最適化とは、機械語翻訳をしているコンピュータマシンの各装置(装置については前述しましたね)に合った処理を生成する事を言います。世の中には様々な形態のコンピューターがあり、そのコンピューターに装備されている装置はそれぞれ異なりますから、その環境に合った実行形式ファイルを生成しなければなりません。

#### 4. 実行形式ファイルの起動

生成された実行形式ファイルは、実行する事ができます。<br>一般家庭用のOSであれば、その殆どがGUIを備えており、GUIの殆どが、実行形式のアイコンをダブルクリックする事でアプリケーションが実行される形態を取っています。

##### GUI

GUIとはグラフィックユーザーインタフェースの事を言います。ユーザーインタフェースとは、ユーザーがコンピューターに対して操作を行う方法の一つとでもしておきます。イメージとしては、マウスポインタがあって、ウィンドウが出てきたりポップアップが出てきたり、というようなユーザーインタフェースの事を言います。

##### CUI

キャラクターユーザーインタフェースと言われるユーザーインタフェースもあります。視覚的なイメージとしては、サイバーなドラマなどでよく出てくる、黒い画面に文字を打ち込むようなものでしょうか。<br>一昔前までは、実はああいったような操作法しかコンピューターは備えておらず、モダンなマウスポインタやウィンドウといったものはありませんでした。あれは何をしているかというと、コマンドと言われる命令を実行しているのです。例えば、OSにも色々な種類がありますが中でもWindowsのシェア率が高いので、今回はWindowsを例に述べます。Windowsには、`dir`といったコマンドがあります。これは、<i>自分自身のいるフォルダ(ディレクトリ)内のファイル/フォルダを全て標準出力に出力しろ</i>といったコマンドです。実際に、Windowsキーを押して、cmdと打ち込み、`dir`コマンドを実行してみてください。ファイル/フォルダ一覧が出力されます。

##### 両者の違いとは

`dir`という実行形式ファイルを実行し、その実行形式ファイルは、<i>自分自身のいるフォルダ(ディレクトリ)内のファイル/フォルダを全て標準出力に出力する</i>というアプリケーションであるから、自分自身のいるフォルダ(ディレクトリ)内のファイル/フォルダが出力されました。GUIとCUIはあくまでインタフェースの違いであり、アプリケーションの動作に対する何らかの変動を与えるものではありません。<br>要するに、CUIに対して<code>dir</code>と打ち込みエンターキーを押すのと、同ファイルである<code>dir</code>というアイコンをダブルクリックするという事は、本質的には同じ事をしているのです。<br>GUIとCUIは、実行形式ファイルを、どのように実行してそれをどのように出力/入力するのかの形態が違うというだけです。

#### 5. 記憶装置からメモリへ処理内容を読み込み

実行形式ファイルを起動すると、RAMメモリーへその内容が順次読み込まれます。

#### 6. メモリからCPUのレジスタへ読み込み

RAMメモリーへ読み込まれた実行内容は順次CPUのレジスタへ読み込まれます。

#### 7. 本処理

レジスタへ読み込まれた内容がCPUによって、順次処理されます。

#### 8. メモリに読み込まれている処理内容をメモリから解放

処理を全て終えた後は、RAMメモリーに読み込まれた内容を解放し、その分の新たなリソースを空けます。プログラムされた内容によっては、正しくメモリ解放が出来ずにアプリケーションが終了してしまう事があります。それを、メモリリークと言います。メモリリークは、絶対に起こしてはならないバグであり、C++言語でもメモリ解放を正しく行うための工夫がされています。C++にはありませんが、メモリ解放などのデータ管理を自動的に全てコンピューター側で処理してくれる、ガベージコレクションと言われる機能のある言語もあります。C++にその機能が実装されていないのは、C++言語を設計するにあたっての基本哲学の1つとして、ゼロオーバーヘッドの原則が掲げられているからです。ゼロオーバーヘッドとは、常に必要でない機能による負荷を完全に無くすという考え方です。

#### 9. 終了

OSに対して終了シグナルを送り、正しく終了したという旨をOSに伝えます。アプリケーションは正しく処理が成され、正しくメモリが解放され、正しく終了しなければなりません。

## 1.1 C++17 とは

本書で解説されるプログラミング言語 C++は、1983年にBjarne Stroustrup氏によってC言語の機能拡張のために開発された、歴史のあるプログラミング言語です。「1.0 プログラミングからアプリケーションの実行/終了の流れ」にて前述した通り分類すると、C++はコンパイル言語です。<br>C++言語の最初の標準として1998年に`ISO/IEC 14882:1998`が承認され、2003年には改訂版として`ISO/IEC 14882:2003`が承認されました。その後、メジャーアップデートとして2011年に`ISO/IEC 14882:2011`が承認され、その三年後である2014年に、`ISO/IEC 14882:2014`が承認されており、最新のC++のバージョンは2017年に承認された`ISO/IEC 14882:2017`、巷ではC++17と呼ばれています。<br>お気づきかもしれませんが、このようにC++という言語は言語仕様の拡張が何度も繰り返されています。そのため言語自体における機能や概念など、プログラミング界の中ではより新しいものを取り入れる傾向にあります。<br>そんなC++言語は、最も利用される商用のプログラミング言語の1つとなっています。

## 1.2 開発環境を整える

プログラムを作成するためには開発環境を利用します。<br>本書ではCUI操作を促進するため、無償で利用できるGNU C++ Compilerのインストール方法を解説します。<br>

### 1.2.1 Windows の場合

MinGWをインストールします。

<ol>

    <li>http://www.mingw.org/へアクセスします</li>

    <li>Downloadsをクリックし、ダウンロードページに遷移します。そこから「mingw-get-setup.exe」をダウンロードし、ダブルクリックでインストールします。![mingwのインストール](/assets/mingwss.png)</li>

    <li>デスクトップにできた「MinGW Installer」を起動します。</li>

    <li>「mingw32-base」「mingw32-gcc-g++」を選択します。UNIX風シェル環境が好ましいのであれば「msys-base」「mingw-developer-toolkit」を選択(Mark for Installation)します。</li>

    <li>Installation -&gt; Apply Changesをクリックするとコンポーネントのダウンロード、インストールが自動で開始します。</li>

    <li>インストール終了後、環境設定からpathを設定します。<br> コントロールパネル -&gt; システム -&gt; システムの詳細設定 -&gt; システムのプロパティ -&gt; 環境変数と辿っていきます。そして環境変数Pathに「C:MinGWbin」を追加します。</li>

    <li>スタートメニューからcmdと入力しコマンドプロンプトを起動します。</li>

    <li><code>gcc --version</code>と打ち、バージョン情報が出力されれば完了です。</li>

</ol>

### 1.2.2 mac OSの場合

XCodeを入手し、コマンドラインツールをインストールします。<br>

<ol>

    <li>App Storeを起動し、Xcodeと検索、インストールします。![appstore](/assets/store.png)</li>

    <li>メニュー「Xcode」からPreferences…を選び上部のDownloadを選びます。</li>

    <li>一覧の中からCommand Line Toolsを選択してインストールします。</li>

    <li>Control + Spaceでterminal.appと打ち込みターミナルを起動します。</li>

    <li><code>gcc --version</code>と打ち、バージョン情報が出力されれば完了です。</li>

</ol>

### 1.2.3 GNU Linuxの場合

aptパッケージ管理システムを用いてインストールします。

<ol>

    <li>terminalを起動します。</li>

    <li><code>sudo apt-get install g++</code>と打ちこみます。</li>

    <li><code>gcc --version</code>と打ち、バージョン情報が出力されれば完了です。</li>

</ol>

### 1.2.4 コンパイル、ビルド

操作は、全てコマンドプロンプト、terminal.app、terminalで行います。(以降ターミナルとします)<br>test.cppというファイル名でソースコードを作成した場合、`g++ test.cpp`といったコマンドでコンパイルを行います。`a`もしくは、`a.out`、`a.exe`といった実行形式ファイルが生成されます。実行には`a`、`./a.out`、`a.exe`などと打ち込む事で実行できます。<br>`g++`コマンドには様々なオプションを付与する事ができます。興味のある方は是非インターネットなどで調べてみてください。