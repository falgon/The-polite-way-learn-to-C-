# 8.2 constexpr

`constexpr`は、コンパイル時の定数を表したり、コンパイル時の処理を表す事のできるキーワードです。`constexpr`は、C++のとても強力な言語機能で、コンパイル時の様々な演算や処理を実現します。順を追って見ていきましょう。

## 8.2 constexpr variable
constexprな変数を定義する事ができます。書式は以下の通りです。
```cpp
constexpr int value=0;
```
`constexpr`は`const`と同じように、定義時になんらかの値で初期化しなければなりません。`constexpr`は定数という性質上、なんらかの値で初期化しなければ意味がないため、この挙動は自然と言えます。ここまで見ると、`const`との違いがあんまり分からないかもしれませんが、`const`と`constexpr`、両者の最たる相違点は**コンパイル時**定数であるか否かという点です。

例えば、以下のコードを見て見ましょう。
```cpp
int main()
{
    int a=10;
    const int b=a; // ok.実行時定数として定義
    constexpr int c=a; // エラー！aはコンパイル時定数ではない
}
```
コメントにある通り、`a`はコンパイル時定数ではなく、動的なプログラムの処理の中で値が変更される恐れがあります。よって、そのような値はコンパイル時定数として初期化する事はできないのです。

というわけで、この`constexpr`キーワードが付与された変数は、コンパイルの段階で既に結果が決まっている処理/値しか入れる事ができないという事を学びましたが、ところで、コンパイル時にできる事とは何なのでしょうか。

それは、静的なオブジェクト/値の演算です。
```cpp
int main()
{
    constexpr int a = 100 * 100; // コンパイル時演算
    constexpr int b = a * 10; // コンパイル時定数と定数の演算はコンパイル時演算
}
```
このように、コンパイル時定数、または定数同士の演算はコンパイル時に実行されるのです。つまり、`100 * 100`と記述した時、実際に`100 * 100`の演算が実行時に行われるのではなく、`10000`という数値としてコンパイルされるのです。よって、`constexpr`な変数に初期化値として与える事ができます。勿論、これは定数であるがための処理であって、動的な処理の演算は、当然ながらコンパイル時に行う事はできません。
```cpp
#include<iostream>
int main()
{
	int a=10,b=20; 
	constexpr int c=a*b; // コンパイル時定数でないオブジェクト同士の演算結果はconstexprの初期化値にできない。
}
```
上記のコードのように、確かに`a`と`b`は、それぞれ初期化のみの操作でその後値の変更はされていませんが、コンパイラはこれら定数である事を推論する事はできないので、コンパイルエラーとなります。このような事をしたければ、`a`、`b`を`constexpr`もしくは`const`で定義する必要があります。
```cpp
#include<iostream>
int main()
{
    const int a=10,b=20;
    constexpr int c=10,d=20;
    
    constexpr int e=a*b; // ok
    constexpr int f=c*d; // ok
}
```
あれ？`const`は実行時定数を指定するキーワードであって、それをコンパイル時定数である`constexpr`変数の初期値として与える事は出来ないのでは？と思うかもしれません。
そうです、途中までは合っています。実は、`const`というキーワードはコンパイル時定数(`constexpr`)にも、実行時定数にもなれるのです。`const`キーワードがコンパイル時定数になる条件は単純です。**`const`な変数の初期化時に与えた値が定数だった場合は、コンパイル時定数として扱え、そうでない場合は実行時定数として扱う**というものです。
```cpp
int main()
{
	const int a=10;
	const int result1=a*10;

	int c=20;
	const int result2=a*c;

	constexpr int resultexpr1=result1; // 演算結果はコンパイル時に得られる。OK
	constexpr int resultexpr2=result2; // result2の演算結果を得るのに定数と断定できない変数cを使っている。それをコンパイル時に得る事はできない。エラー！
}
```