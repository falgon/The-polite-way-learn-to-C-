# Chapter 2:C++の基本

殆どのプログラミング入門書は、Hello,World!といった文字列を出力するプログラムを、始めに作成します。しかし、筆者としては突然Hello,World!を提示されても、学習者からすると意味がわからないとも思うのです。以下をいきなり掲示されて、コードの細かい部分まで何をしているのか予測がつきますでしょうか。

```cpp
#include<iostream>
int main()
{
    std::cout << "Hello,World!" << std::endl;
}
```

本書ではそのような方向からのアプローチを避け、一つ一つ概念を理解してからコードの解説に移行します。<br>本章では以下のような流れで解説をしていきます。

1. 変数とデータ型
2. 最小のプログラムと実際のコード
3. 配列を触って見る

## 2.3 最小のプログラムと実際のコード

変数の概念を理解したところで、これから、いよいよ初めてのプログラムを作ります。しかし初めから色々な機能のあるプログラムを作成する事は不可能なので、まずは最小のプログラムを作っていきます。<br>

### 2.3.1 main関数とreturn文

そもそも、C++のプログラムを作るのにどのような知識が必要になるでしょうか。それにはまず、そのプログラム言語の構造を知る事が第一です。<br>例えばあなたは木製の椅子を作ろうとしました。しかし木製の椅子を作るには、木製の椅子の構造を知っていなければ、作りあげる事はできません。<br>ではC++の構造とはどのような構造なのでしょうか。木製の椅子を作るためには様々な椅子に合いそうな木、つまり部品が必要になります。プログラムも、同じように部品の集合で成り立っているのです。その部品をC++では関数と言います。<br>そして以下が、C++の最小のコードであり、全てはここから始まります。

```cpp
int main(){}
```

これは、「メイン関数」と言います。C++のプログラムには、メイン関数が1つ必ずなくてはなりません。そして、メイン関数の<code>{}</code>内に処理を書く事ができます。しかし、今は何も書いていないので、これは何もしません。<br>意味合いとしては、「int型のデータを返すmainという名前の関数」という意味合いになります。<br>int型のデータを返すとはなんでしょう？まずメイン関数は、プログラムを実行した際、一番初めに実行される内容となります。このプログラムが起動した後、このコードには、何も記述されていないので、何もせずに、メイン関数でプログラムを終了する事になります。そのプログラムを終了する際に、プログラムを実行した元のプログラムへ、数値を返すという慣習があるのです。 <br>例えば、Windowsで、「a」というアプリケーションを起動したとします。「a」は正しく処理がなされました。しかし、起動元であるWindowsは、そのアプリケーションが正しく処理されたかどうか知ることができません。そこで、「a」というアプリケーションは、例えば0という数値をWindowsへ返したとします。そしてWindowsは0という数値が返ってくると正常に終了したと認識するとします。ここで初めて、Windowsは「a」というアプリケーションは正常に実行されたという事が認識できるのです。このような事のために、メイン関数にはintという数値を返す関数であるという定義を行います。つまり、上記のコードは厳密に言えば、こう書くべきかもしれません。

```cpp
int main(){return 0;}
```

このように<code>return value;</code>と書く事で、その<code>value</code>を起動元のプログラムへ返し、その関数の処理が終了します。つまり上記のプログラムは0を返してプログラムを終了しろという意味になります。<br>初めにreturn文を省略した訳は、実行結果を判定する必要の無いプログラムだからです。そういった場合は、return文を省略しても構わない事となっています。<br>

### 2.3.2 インデント

先ほど、私は以下が最小のコードだと述べました。

```cpp
int main(){}
```

しかし、これはこのように記述する事ができます。

```cpp
int main()
{
}
```

このように書くこともできます。

```cpp
int main()
{
                    }
```

このようにも。

```cpp
int
main(
){
}
```

このように、キーワード単位が守られた記述であれば、どのように改行したりスペースを入れたり、タブを入れたりしても構わない事となっています。このようにスペースやタブ等の事をインデントと言います。<br>ただ一つ注意してほしいのが、全角のスペースです。コードの中には全角のスペースでインデントを入れる事はできません。もし全角スペースでインデントを入れると、コンパイラ(GCC 6.1.0)はこのようなエラーを出力します。<pre>t.cpp:3:1: エラー: プログラム内に逸脱した ‘\343’ があります ??? ^t.cpp:3:2: エラー: プログラム内に逸脱した ‘\200’ があります ??? ^t.cpp:3:3: エラー: プログラム内に逸脱した ‘\200’ があります ??</pre>全角スペースは、視覚的に確認できるものではないので、タイプミスなどで挿入してしまう場合があります。注意しましょう。

### 2.3.3 コメント

ここでついでに、コメント機能についても触れておきましょう。コメントとは、プログラムに注釈のような一言メモを添えておける機能です。実は、ここまでで示したサンプルコードの中にも、いくつかコメントが書かれていました。

```cpp
int x=10; // xには10が入ってます
```

<code>//</code>から先は、プログラム中に日本語が含まれています。<code>//</code>を使う事で<code>//</code>以降その段落はコメントとしてコンパイラに捉えられるので、何を書いても良い事になっています。

```cpp
int x=10; // xには10が入っているはずなんですよね〜〜ああ、お腹すいたな。
```

と書いてもプログラム上は問題ありません。(無関係な内容を書くべきではありません)<br>また、<code>//</code>以外に、<code>/&#42; &#42;/</code>というようなコメント機能もあります。

```cpp
int x=10; /* xには10が入っていると思われるのであります。 */
```

<code>/&#42; &#42;/</code>で囲んでいる範囲はコメントとなるので、何を書いてもプログラム上は問題ありません。(無関係な内容を書くべきではありません)

### 2.3.4 数値演算のプログラム

ここまでで、変数とmain関数の概念を説明しました。以上の概念を用いて、ついに実際のプログラムを作る事ができます。

```cpp
int main()
{
    int a=10,b=10;
    int result=a+b;
}
```

<code>result</code>に<code>a</code>と<code>b</code>の加算結果を得るというプログラムを書く事ができるようになりました。尚、変数宣言は上記のように、<code>,</code>を使う事で連続的に変数を宣言する事ができます。動きとしては、下記コードと同じです。

```cpp
int main()
{
    int a=10;
    int b=10;
    int result=a+b;
}
```

ただ、<code>,</code>を用いて変数宣言をした以上、<code>,</code>で宣言された変数は全てその型となるという事を注意してください。つまり、

```cpp
int main()
{
    int a=10,b=3.14;
}
```

とした場合、bには3が代入されるという事です。3.14を代入したければ、

```cpp
int main()
{
    int a=10;
    double b=3.14;
}
```

のように別の型を用いて定義しなければなりません。

## 2.4 配列を触ってみる

ここで、配列という少し新しい概念を説明します。ただ、配列の概念はこれから新たに学ぶ他概念を含んだものでもありますので、ここでは一旦軽く触れる程度の解説をします。そのため、配列の細かい概念、定義はまた後に取り上げる事としていますので、本項を「触ってみる」としています。<br>では、見ていきましょう。配列は、以下のような場合に有効的な概念です。

```cpp
int main()
{
    int a,b,c,d,e,f,g,h,i,j,k,l,m;
}
```

整数型の変数<code>a</code>~<code>m</code>の13個の変数が宣言されています。<br>13個であるなら、確かにまだ<code>a</code>~<code>m</code>を手で打てますね。では1000個の変数を宣言したい場合はどう書きますか？

```cpp
int a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,a1,a2,a3...
```

と全て手で入力していては、日が暮れてしまいますね。<br>そこで、配列という概念を用いる事で、以下のように書く事ができます。

```cpp
int main()
{
    int a[1000];
}
```

<code>型 変数名[要素数];</code>と記述する事で一気に要素数分の変数を宣言する事ができます。<br>しかし、こう思うかもしれません。<br>「<code>int a,b,c,d,e,f...</code>と書いたら<code>b</code>とか<code>f</code>とか書く事でその変数への操作が出来るけど、<code>int a[1000];</code>と書いたら1000個分のうちのどれに操作するのかとか書けないんじゃ...？」<br>いいえ、その心配はありません。例えば、20番目の変数に対して操作がしたいのであれば、以下のように記述できます。

```cpp
int main()
{
    int a[1000];
    a[19];
}
```

<code>変数名[アクセスしたい要素の値]</code>と記述する事でその要素へ操作を行う事が可能です。ここでまた、<br>「え、20番目の変数に対して操作がしたいのに、19って書いてあるじゃないか！」<br>と思うかもしれません。実はその理由は、配列の要素は0から始まるというところにあります。例えば三つの要素数を持つ配列を定義した場合、以下のようになります。

```cpp
int main()
{
    int a[3]; // a[0],a[1],a[2]を操作できる
}
```

つまり、`int a[3];`と書かれたものに対して、`a[3];`と操作を行う事はできないという事です。`a[4];`でも`a[200];`でも同じです。`型 変数名[要素数]`と宣言された場合、指定できる要素数は、`変数名[要素数-1]`となるという事が言えます。これはとても大切で、肝に銘じるべき内容です。宣言された配列の要素数以上への操作は絶対にしてはいけません。もしそのような操作を行った場合、プログラムの挙動がどうなるかは全く保証されていません。大抵の場合、segmentation faultというエラー文と共にプログラムが強制終了するでしょうが、環境によってOSが破壊される可能性もゼロではありません。宣言された配列の要素数以上への操作は絶対に記述しないようにしましょう。

最後に、配列に対する初期化はどのように書けばいいのでしょうか。代入であれば以下のように書く事ができる事が考えられますね。

```cpp
int a[3];
a[0]=10;
a[1]=20;
a[2]=30;
```

初期化は、以下のように記述します。

```cpp
int a[3]={10,20,30};
```

この場合、それぞれ、`a[0]`は10、`a[1]`は20、`a[2]`は30で初期化されます。また、この一文は以下のようにも記述できます。

```cpp
int a[]={10,20,30};
```

要素数が明示されていませんが、文法として正しい一文です。このように、初期化の際に値を設定するのであれば、要素数を省略する事ができます。この場合、aの要素数は自動的に3となり、それぞれ<code>a[0]</code>は10、<code>a[1]</code>は20、<code>a[2]</code>は30で初期化されます。

では、以下はどのような出力結果となるでしょうか。

```cpp
#include<iostream>
int main()
{
    int a[3]={};
    std::cout<<a[0]<<'\n'<<a[1]<<'\n'<<a[2]<<std::endl;
}
```
実行結果は以下のようになります。
```cpp
0
0
0
```

なんと全ての要素の値が0で初期化されています。これは、規定された言語上の仕様です。空のリストを初期化時に指定すると要素の値は全て0で初期化されます。では、以下の場合、どのような出力結果となるでしょうか。

```cpp
#include<iostream>
int main()
{
    int a[3]={42};
    std::cout<<a[0]<<'\n'<<a[1]<<'\n'<<a[2]<<std::endl;
}
```

実行結果は以下のようになります。

```cpp
42
0  
0 
```

3つ要素がある中で、初期化値として指定したのは一つの値、`42`だけです。この場合、先頭の要素が指定された値に初期化され、残りの要素は全て0で初期化されます。これも、規定された言語上の仕様です。

これは余談ですが、以下のようなコードを書く事はC++では規格違反です。

```cpp
int a[3]={[1]=42};
```

意味合いとしては、`a[1]`のみを42で初期化し、それ以外の要素を0で初期化するという意味合いに取れますが、厳密には規格違反となっています。このコードを警告も吐かずにコンパイル成功してしまうコンパイラも中には存在するのですが、この文法は、C言語の99というバージョンから実装された機能であり、C++17の規格段階では取り入れられていないため、規格違反と言えるのです。