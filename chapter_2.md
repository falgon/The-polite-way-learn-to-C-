# Chapter 2:C++の基本

殆どのプログラミング入門書は、Hello,World!といった文字列を出力するプログラムを、始めに作成します。しかし、筆者としては突然Hello,World!を提示されても、学習者からすると意味がわからないとも思うのです。以下をいきなり掲示されて、コードの細かい部分まで何をしているのか予測がつきますでしょうか。

```cpp
#include<iostream>
int main()
{
    std::cout << "Hello,World!" << std::endl;
}
```

本書ではそのような方向からのアプローチを避け、一つ一つ概念を理解してからコードの解説に移行します。<br>本章では以下のような流れで解説をしていきます。

1. 変数とデータ型
2. 最小のプログラムと実際のコード
3. 配列を触って見る

## 2.4 配列を触ってみる

ここで、配列という少し新しい概念を説明します。ただ、配列の概念はこれから新たに学ぶ他概念を含んだものでもありますので、ここでは一旦軽く触れる程度の解説をします。そのため、配列の細かい概念、定義はまた後に取り上げる事としていますので、本項を「触ってみる」としています。<br>では、見ていきましょう。配列は、以下のような場合に有効的な概念です。

```cpp
int main()
{
    int a,b,c,d,e,f,g,h,i,j,k,l,m;
}
```

整数型の変数<code>a</code>~<code>m</code>の13個の変数が宣言されています。<br>13個であるなら、確かにまだ<code>a</code>~<code>m</code>を手で打てますね。では1000個の変数を宣言したい場合はどう書きますか？

```cpp
int a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,a1,a2,a3...
```

と全て手で入力していては、日が暮れてしまいますね。<br>そこで、配列という概念を用いる事で、以下のように書く事ができます。

```cpp
int main()
{
    int a[1000];
}
```

<code>型 変数名[要素数];</code>と記述する事で一気に要素数分の変数を宣言する事ができます。<br>しかし、こう思うかもしれません。<br>「<code>int a,b,c,d,e,f...</code>と書いたら<code>b</code>とか<code>f</code>とか書く事でその変数への操作が出来るけど、<code>int a[1000];</code>と書いたら1000個分のうちのどれに操作するのかとか書けないんじゃ...？」<br>いいえ、その心配はありません。例えば、20番目の変数に対して操作がしたいのであれば、以下のように記述できます。

```cpp
int main()
{
    int a[1000];
    a[19];
}
```

<code>変数名[アクセスしたい要素の値]</code>と記述する事でその要素へ操作を行う事が可能です。ここでまた、<br>「え、20番目の変数に対して操作がしたいのに、19って書いてあるじゃないか！」<br>と思うかもしれません。実はその理由は、配列の要素は0から始まるというところにあります。例えば三つの要素数を持つ配列を定義した場合、以下のようになります。

```cpp
int main()
{
    int a[3]; // a[0],a[1],a[2]を操作できる
}
```

つまり、`int a[3];`と書かれたものに対して、`a[3];`と操作を行う事はできないという事です。`a[4];`でも`a[200];`でも同じです。`型 変数名[要素数]`と宣言された場合、指定できる要素数は、`変数名[要素数-1]`となるという事が言えます。これはとても大切で、肝に銘じるべき内容です。宣言された配列の要素数以上への操作は絶対にしてはいけません。もしそのような操作を行った場合、プログラムの挙動がどうなるかは全く保証されていません。大抵の場合、segmentation faultというエラー文と共にプログラムが強制終了するでしょうが、環境によってOSが破壊される可能性もゼロではありません。宣言された配列の要素数以上への操作は絶対に記述しないようにしましょう。

最後に、配列に対する初期化はどのように書けばいいのでしょうか。代入であれば以下のように書く事ができる事が考えられますね。

```cpp
int a[3];
a[0]=10;
a[1]=20;
a[2]=30;
```

初期化は、以下のように記述します。

```cpp
int a[3]={10,20,30};
```

この場合、それぞれ、`a[0]`は10、`a[1]`は20、`a[2]`は30で初期化されます。また、この一文は以下のようにも記述できます。

```cpp
int a[]={10,20,30};
```

要素数が明示されていませんが、文法として正しい一文です。このように、初期化の際に値を設定するのであれば、要素数を省略する事ができます。この場合、aの要素数は自動的に3となり、それぞれ<code>a[0]</code>は10、<code>a[1]</code>は20、<code>a[2]</code>は30で初期化されます。

では、以下はどのような出力結果となるでしょうか。

```cpp
#include<iostream>
int main()
{
    int a[3]={};
    std::cout<<a[0]<<'\n'<<a[1]<<'\n'<<a[2]<<std::endl;
}
```
実行結果は以下のようになります。
```cpp
0
0
0
```

なんと全ての要素の値が0で初期化されています。これは、規定された言語上の仕様です。空のリストを初期化時に指定すると要素の値は全て0で初期化されます。では、以下の場合、どのような出力結果となるでしょうか。

```cpp
#include<iostream>
int main()
{
    int a[3]={42};
    std::cout<<a[0]<<'\n'<<a[1]<<'\n'<<a[2]<<std::endl;
}
```

実行結果は以下のようになります。

```cpp
42
0  
0 
```

3つ要素がある中で、初期化値として指定したのは一つの値、`42`だけです。この場合、先頭の要素が指定された値に初期化され、残りの要素は全て0で初期化されます。これも、規定された言語上の仕様です。

これは余談ですが、以下のようなコードを書く事はC++では規格違反です。

```cpp
int a[3]={[1]=42};
```

意味合いとしては、`a[1]`のみを42で初期化し、それ以外の要素を0で初期化するという意味合いに取れますが、厳密には規格違反となっています。このコードを警告も吐かずにコンパイル成功してしまうコンパイラも中には存在するのですが、この文法は、C言語の99というバージョンから実装された機能であり、C++17の規格段階では取り入れられていないため、規格違反と言えるのです。