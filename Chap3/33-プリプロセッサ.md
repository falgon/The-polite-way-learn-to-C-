# 3.3 プリプロセッサ

「3.1.1 インクルード」などで`#include`について触れました。この項では、さらに深くプリプロセスの概要と、`#include`以外のプリプロセッサ命令を見ていきます。

## 3.3.1 プリプロセスとは
プリプロセスとは「1.1.2 プログラミングからアプリケーションの実行/終了の流れ」の項で実行ファイルを生成するまでの一連の流れを示した通り、コンパイル(構文解析)の前にされる処理です。そしてプリプロセスを行う機構をプリプロセッサと言います。そしてそれに対する命令をプリプロセッサ命令と言います。プリプロセッサ命令をする事で何ができるのかと言うと、`#include`のように文字列の置換であったり、その他無効化、情報の出力などを行うことができます。gcc や clang++ でプリプロセッサーの様子を見たい場合、以下のようにコマンドを指定することで可能です。
```cpp
$ g++ -E -P file.cpp
$ clang++ -E -P file.cpp
```

## 3.3.2 #include
まず`#include`命令を見てみましょう。何度か述べている通り、`#include`は指定されたファイルの中身をそのままその部分に置換します。
```cpp
// a.hpp
void f(){}
```
```cpp
// a.cpp
#include"a.hpp"
void f();
int main(){}
```
これをコンパイルすると、
```cpp
$ g++ -E -P a.cpp
```
以下のように出力されます。
```cpp
void f(){}

void f();
int main()
{
 f();
}
```
a.hppの内容がそのままa.cppに置換されている事がわかります。この時`#include`の部分で`"`を使っていますね。しかし例えば`iostream`をインクルードするときは、`<>`を使っていました。これらには動作の違いがあります。

`"`でファイル名を囲んだ場合、処理中のファイルからの相対パス(処理中ファイルの主観から見たファイル位置)でその指定ファイルを探し、その中で見つからなかった場合、事前に組み込まれた標準ライブラリのパスや、追加で渡されたインクルードパスを探します。

`<>`でファイル名を囲んだ場合、**インクルードパスのみ**を探索します。

インクルードパスは、コマンドオプションで指定することができます。例えば、以下のように。
```cpp
$ g++ -I < file path > file.cp
```
`< file path >`の部分にパスを指定します。以下に例を示します。
```cpp
// a.hpp
void f(){}
```
```cpp
// a.cpp
#include<a.hpp> // インクルードパスのみを探索
void f();
int main(){}
```
以下のように実行します。
```cpp
$ g++ -E -P -I . a.cpp
```
`-I`オプションの後に追加するインクルードパスに`.`として自分自身のいる場所とすることで、ファイルを見つける事ができていますね。


`iostream`などの標準で搭載されているヘッダーファイルは、標準的にインクルードパスとされていますので、`<>`が使われています。
しかし以下のようにも勿論できます。
```cpp
#include"iostream"
```
しかし、`"`はインクルードパス以外のパスも探索してしまいますので、効率的とは言えません。よってインクルードパス内のファイルを`#include`するのであれば`<>`を使うべきとなります。

## 3.3.3 #define
`#define`は文字どおり、定義する事ができます。主に**マクロ**を定義します。マクロは以下の二つの使い方が可能です。

### オブジェクト形式マクロ
```cpp
#define ONE 1
#define STRING string
```
このようにマクロを定義した場合、ONEという文字列が1に置き換えられます。試しに使って見ましょう。
```cpp
#define ONE 1
#define INT int
#define VALUE value
#include<iostream>
int main()
{
	INT VALUE=10;
	std::cout<< VALUE <<std::endl;
	std::cout<< ONE <<std::endl;
}
```
実行結果は以下となります。
```cpp
10
1
```
`ONE`は`1`に、`INT`は`int`に、`VALUE`は`value`に置き換わっていますね。マクロ名は空白や記号（`_`を除く）で区切られた文字列が該当します。従って、ソースファイル中に例えば`NOT_ONE`という文字列が出現しても、`NOT_1`に置換されることはありません。

### 関数形式マクロ
