# 16.6 補数

この項ではコンピュータの基礎である補数の考え方とその利用例に説明します。

## 16.6.1 補数とは何か

ある定数値`x`に対して`y`を足します。この時

1. `x + y` の結果、`x`の桁をあげる事となる`y`
2. `x + y` の結果、`x`の現在の桁で最大の数値となる`y`

をどちらも共に、**補数**と言います。補数は、この通り二つの種類があります。
そしてまた、補数は、基底の数(何進数か)によって変動します。
例えば 10 進数においては、10 という単位で桁が上がるので、1. のことを 10 の補数と言い、10 進数において 2. のことを 9 の補数と言います。
続けて 2 進数においては、2 という単位で桁が上がるので、1. のことを 2 の補数と言い、2進数において 2. のことを 1 の補数と言います。

## 16.6.2 補数を求める

### 10 進数
10 進数の補数の求め方は直感的であるため、比較的容易です。
例えば、`5`という 10 進数値があるとします。
これに対する 9 の補数は `5 + x = 9` より`4`です。またこれに対する 10 の補数は `5 + x = 10` より`5`です。
次に、`15`という 10 進数値があるとします。
これに対する 9 の補数は`15 + x = 99`より`84`です。またこれに対する 10 の補数は `15 + x = 100` より`85`です。

このように、a の補数と言われる場合、補数に対する値は a 進数であり、a 進数においてある値に対して桁を上げる事となる値、またある値の桁の最大値となる値を補数と言います。

### 2 進数
2 進数における補数表現の考え方はコンピューターでとてもよく利用される手法です。
例えば `011` という 2 進数値があるとします。
これに対する 1 の補数は `100` です。またこれに対する 2 の補数は `101` です。なぜこの様になるのかは順を追えば理解できるはずです。

二進数において桁が上がるには二つの段階しかありません。`0`もしくは`1`のみである。この次の値を表すには桁を上げるしかありません。
`011`を二進数における 3 桁であると捉えると、この 3 桁で表せる最大の数値は`111`ですから、つまり、1 の補数は以下の様にして考える事ができます。
```
// 値は 2進数値である。
// 慣用として 2 進数値である事を表すために、
// 数値の頭に `b` を記述する。 
b011 + x = b111 
```
この時の`x`が 1 の補数です。`011`に何を足せば`111`になるのでしょうか。`100`ですね。よって、1 の補数は`100`です。

次に 2 の補数について考えます。といっても、ここまで理解できていれば全く難しいことはありません。
2 の補数というのは、二進数において桁を上げる数値なので、単純に 1 の補数 + 1 の値になるはずです。
1 の補数は `100`であったから、それに 1 を加えた`101`を`011`に加える事で桁上がりが起きるのである。
よって、2 の補数は`101`です。

これがわかると、慣例として言われる、「ある値のビット反転 + 1 がある値の 2 の補数である」という法則にも納得が行くはずです。
まずビット反転とは、単純に全てのビットが反転するという事です。つまり`1`だったら`0`になるし、`0`だったら`1`になるという事です。
例えば、`1010`という値をビット反転したら`0101`、`1100`という値をビット反転したら`0011`です。

「ある値のビット反転 + 1 がある値の 2 の 補数である」という話に戻します。
先ほどの例の数値`011`を再度用います。この値をビット反転した値は、`100`です。これは、先ほど求めた 1 の補数です。
これに 1 を加えると先ほど求めた 2 の補数ですね(`101`)。これが、「ある値のビット反転 + 1 がある値 2 の補数である」の仕組みです。

## 16.6.3 何に使えるのか
コンピューターによる減算に利用される。実は、コンピューターによる減算は回路を簡素化するために、足し算で行われています。
例えば`x - x = y`で、`y`を加算のみで演算しようとすると以下の様になります。
```
x + (x の 2 の補数) から桁上がりの部分を捨てた値 = y
```
実際に値を入れると分かりやすいでしょう。`x`を二進数の`011`とすると、
```
b011 + (b011 の 2 の補数) から桁上がりの部分を捨てた値 = y
```
となる。次に、`011`の 2 の補数を求めると以下の様になります。
```
b011 + b101 から桁上がりの部分を捨てた値 = y
```
さてではこれを演算します。`+`表記があるので、加算を行います。
```
b1000 から桁上がりの部分を捨てた値 = y
```
後は、「桁上がりの部分を捨てた値」について処理すれば完了ですね。
`b011 + b101`の加算処理によって、ここまで 3 桁であったものが 4 桁の 2 進数値になりました。
「桁上がりの部分」とは、この時`b1000`の先頭の`1`を示します。
```
b000 = y
```
このようにして、演算結果である`0`を`-`を使わずに加算だけで求める事ができました。別の値でもやってみましょう。

例えば、`5 - 3`を上記の手法で解いてみます。`5`は二進数表記で`101`、`3`は二進数表記で`011`です。
```
b101 + (b011 の 2 の補数) から桁上がりの部分を捨てた値 = y
```
`(b011 の 2 の補数)`を展開すると以下の様になります。
```
b101 + b101 から桁上がりの部分を捨てた値 = y
```
`b101 + b101`の加算を行います。
```
b1010 から桁上がりの部分を捨てた値 = y
```
桁上がりを捨てます。
```
b0010
```
`b0010`は 10 進数で `2`です。
